{% extends 'CEO/base.html' %}
{% block content %}

  <div class="col-lg-12 grid-margin stretch-card" style="margin: 5px;">
    <div class="card">
      <div class="card-body">

        <div class="row">
          <div class="col">
            <div class="row">
              <h4 class="col card-title">Users Management</h4>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col">
            <h4><a class="btn-success" href="{% url 'add_user' %}" class=""><i class="mdi mdi-account-plus me-2 text-success"></i> Add user</a></h4>
          </div>
          <div class="col">
            <h4><a class="btn-success" href="{% url 'activate_all_user' %}" class=""> activate all user</a></h4>
          </div>
          <div class="col">
            <h4><a class="btn-danger" href="{% url 'deactivate_all_user' %}" class=""></i>deactivate all user</a></h4>
          </div>
        </div>
        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>User</th>
                <th>First name</th>
                <th>Lastname</th>
                <th>Username</th>
                <th>User_type</th>
                <th colspan="3" style="text-align: center;">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for userr in users %}
              <div id="modal-{{ userr.id }}" class="modal" tabindex="-1">
                <div class="modal-dialog modal-dialog-centered">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title">Delete {{ userr.first_name }} {{ userr.last_name }}</h5>
                      <button type="button" class="close" data-dismiss="modal" data-item-id="{{ userr.id }}">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <form class="rating-form">
                        {% csrf_token %}
                        <div class="form-group">
                          <label for="rating">Delete User</label>
                          <input type="hidden" name="rating" value="0" class="form-control rating-value">
                        </div>
                        <div class="rating">
                          <p>You are about to delete, Permanently the User named as</p>
                          <h4>{{userr.first_name}}  {{userr.last_name}}</h4>
                          <p>with id <b>{{userr.id}}</b> and email <b>{{userr.email}}</b> Whose duties is <b>{{userr.user_type}}</b>
                          </b> information will never Appear again Confirm bellow to delete</p>
                        </div>
                      </form>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="close btn btn-secondary" data-dismiss="modal">Close</button>
                      <a href="{% url 'delete_user' userr.id%}" class="btn btn-danger">Confirm Delete</a>
                    </div>
                  </div>
                </div>
              </div>
                <tr>
                  <td class="py-1">
                    {% if userr.profile %}
                      <img src="{{ userr.profile.url }}" alt="image" />
                    {% endif %}
                  </td>
                  <td>{{ userr.first_name }}</td>
                  <td>{{ userr.last_name }}</td>
                  <td>{{ userr.username }}</td>
                  <td>{{ userr.user_type }}</td>
                  <td>
                    <a href="{% url 'userprofile'  userr.id  %}" style="color: green;"><i class="fa-solid fa-eye"></i> view</a>
                  </td>
                  <td>
                    <button class="btn-warning rate-button" data-item-id="{{ userr.id }}">delete</button>
                  </td>
                  {%if userr.is_active %}
                  <td>
                    <a class="btn-warning rate-button" href="{% url 'deactivate_user'  userr.id  %}">deactivate</a>
                  </td>
                  {%else%}
                  <td>
                    <a class="btn-success rate-button" href="{% url 'activate_user'  userr.id  %}">activate</a>
                  </td>
                  {%endif%}
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const rateButtons = document.querySelectorAll(".rate-button");
      const modals = document.querySelectorAll(".modal");

      rateButtons.forEach(button => {
        button.addEventListener("click", () => {
          const itemId = button.getAttribute("data-item-id");
          const modal = document.getElementById(`modal-${itemId}`);
          modal.style.display = "block";
        });
      });

      modals.forEach(modal => {
        const closeButtons = modal.querySelectorAll(".close");
        const ratingForm = modal.querySelector(".rating-form");
        const ratingValue = modal.querySelector(".rating-value");
        const stars = modal.querySelectorAll(".fa-star");

        closeButtons.forEach(closeButton => {
          closeButton.addEventListener("click", () => {
            modal.style.display = "none";
          });
        });


        ratingForm.addEventListener("submit", event => {
          event.preventDefault();
          const itemId = modal.getAttribute("id").replace("modal-", "");
          const rating = ratingValue.value;

          // Send the rating to the server using JavaScript (e.g., via AJAX) and handle the confirmation on the server side.

          // Optionally, you can provide user feedback (success/error messages) based on the server's response.

          modal.style.display = "none";
        });
      });

      window.addEventListener("click", event => {
        modals.forEach(modal => {
          if (event.target === modal) {
            modal.style.display = "none";
          }
        });
      });
    });
  </script>
{% endblock %}
